<app-navbar></app-navbar>

<div class="container mt-4">
  <!-- Display Google login-specific text box for repository URL -->
  <div class="row mb-4">
    <ng-content *ngIf="!hasGithub else githubUserTemplate">
      <div class="col-md-6 mb-3 mb-md-0">
        <input type="text" class="form-control" id="repoUrl" (input)="onRepoUrlInput($event)" placeholder="https://github.com/user/repo">
      </div>
    </ng-content>

    <!-- Display GitHub user-specific repository dropdown -->
    <ng-template #githubUserTemplate>
      <div class="col-md-6 mb-3 mb-md-0">
        <select class="form-select" aria-label="Select Repository" (change)="onRepoChange($event)">
          <option selected>Select Repository</option>
          <option *ngFor="let repo of repositories$ | async" [value]="repo.name">{{ repo.name }}</option>
        </select>
      </div>
    </ng-template>

    <!-- Dropdown for selecting pull requests -->
    <div class="col-md-6">
      <select class="form-select" aria-label="Select Pull Request" *ngIf="pullRequests.length > 0" (change)="onPRChange($event)">
        <option selected>Select Pull Request</option>
        <option *ngFor="let pr of pullRequests" [value]="pr.url">{{ pr.title }}</option>
      </select>
    </div>
  </div>

  <app-pr-details [selectedPR]="selectedPR" [aiReviewResult]="aiReviewResult"></app-pr-details>


  <ng-content *ngIf="pullRequestFiles.length > 0">
    <div class="row mb-4" *ngFor="let file of pullRequestFiles">
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header">
            {{ file.filename }}
          </div>
          <div class="card-body">
            <div class="code-block">
              <ng-content *ngIf="file.patch">
                <div *ngFor="let line of file.patch.split('\n'); let i = index">
                  <span class="line-number">{{ i + 1 }}</span>
                  <span class="code-content" [ngClass]="{'code-addition': line.startsWith('+'), 'code-deletion': line.startsWith('-')}">
                    {{ line }}
                  </span>
                </div>
              </ng-content>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <ngx-skeleton-loader *ngIf="isLoading"
                             appearance="custom-content"
                             [theme]="{
    'background-color': 'rgba(255, 255, 255, 0.1)',
    'border-radius': '10px',
    'height': '100%',
    'width': '100%',
    'backdrop-filter': 'blur(10px)'
  }">
        </ngx-skeleton-loader>

        <div class="card h-100" *ngIf="!isLoading">
          <div class="card-header">
            AI Review for {{ file.filename }}
          </div>
          <div class="card-body">
            <ng-container>
              <p class="card-text">{{ file.aiReview }}</p>
            </ng-container>
          </div>
        </div>
      </div>

    </div>
  </ng-content>
</div>

