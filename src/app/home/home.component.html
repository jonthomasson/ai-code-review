<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <a class="logo" href="#">
      <i class="bi bi-github logo-icon"></i>
      <span>odeAI Review</span>
    </a>
    <div class="ms-auto">
      <div class="dropdown">
        <button class="btn btn-link text-light" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="Logged in as {{currentUser()?.email}}">
          <img *ngIf="currentUser" [src]="currentUser()?.photoURL" class="profile-img" alt="Logged in as {{currentUser()?.email}}" />
          <i *ngIf="!currentUser" class="bi bi-person-circle fs-4"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
          <li><a class="dropdown-item" href="#" (click)="logout()">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <!-- Display Google login-specific text box for repository URL -->
  <div class="row mb-4">
    <ng-content *ngIf="isGoogleUser else githubUserTemplate">
      <div class="col-md-6 mb-3 mb-md-0">
        <input type="text" class="form-control" id="repoUrl" (input)="onRepoUrlInput($event)" placeholder="https://github.com/user/repo">
      </div>
    </ng-content>

    <!-- Display GitHub user-specific repository dropdown -->
    <ng-template #githubUserTemplate>
      <div class="col-md-6 mb-3 mb-md-0">
        <select class="form-select" aria-label="Select Repository" (change)="onRepoChange($event)">
          <option selected>Select Repository</option>
          <option *ngFor="let repo of repositories" [value]="repo.name">{{ repo.name }}</option>
        </select>
      </div>
    </ng-template>

    <!-- Dropdown for selecting pull requests -->
    <div class="col-md-6">
      <select class="form-select" aria-label="Select Pull Request" *ngIf="pullRequests.length > 0" (change)="onPRChange($event)">
        <option selected>Select Pull Request</option>
        <option *ngFor="let pr of pullRequests" [value]="pr.url">{{ pr.title }}</option>
      </select>
    </div>
  </div>




  <!-- Collapsible Pull Request Details (No TS Changes Required) -->
  <div *ngIf="selectedPR" class="row mb-4">
    <div class="col-md-12">
      <!-- Pull Request Details Button -->
      <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#prDetails" aria-expanded="false" aria-controls="prDetails">
        Pull Request Details <i class="bi bi-chevron-down"></i>
      </button>

      <!-- AI Suggestion Details Button -->
      <button class="btn btn-secondary ms-3" type="button" data-bs-toggle="collapse" data-bs-target="#aiDetails" aria-expanded="false" aria-controls="aiDetails">
        AI Review Details <i class="bi bi-chevron-down"></i>
      </button>

      <!-- Collapsible Pull Request Details -->
      <div class="collapse mt-3" id="prDetails">
        <div class="card">
          <div class="card-header">Pull Request Information</div>
          <div class="card-body row">
            <div class="col-md-6">
              <h5 class="card-title">{{ selectedPR.title }}</h5>
              <p class="card-text"><strong>Description:</strong> {{ selectedPR.body || 'No description provided.' }}</p>
              <p class="card-text"><strong>Author:</strong> {{ selectedPR.user.login }}</p>
            </div>
            <div class="col-md-6">
              <p class="card-text"><strong>Created At:</strong> {{ selectedPR.created_at | date:'medium' }}</p>
              <p class="card-text"><strong>Last Updated:</strong> {{ selectedPR.updated_at | date:'medium' }}</p>
              <p class="card-text"><strong>State:</strong> {{ selectedPR.state }}</p>
              <p class="card-text"><strong>Number of Commits:</strong> {{ selectedPR.commits }}</p>
              <p class="card-text"><strong>Number of Files Changed:</strong> {{ selectedPR.changed_files }}</p>
              <a [href]="selectedPR.html_url" class="btn btn-primary" target="_blank">View on GitHub</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Collapsible AI Suggestion Details -->
      <div class="collapse mt-3" id="aiDetails">
        <div class="card">
          <div class="card-header">AI Review Information</div>
          <div class="card-body">
            <p><strong>Score:</strong> {{ aiReviewResult?.score || 'N/A' }}</p>
            <p><strong>Standards Applied:</strong> {{ aiReviewResult?.standards || 'N/A' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Display changes for pull requests -->
  <ng-content *ngIf="pullRequestFiles.length > 0">
    <div class="row mb-4" *ngFor="let file of pullRequestFiles">
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header">
            {{ file.filename }}
          </div>
          <div class="card-body">
            <div class="code-block">
              <div *ngFor="let line of file.patch.split('\n'); let i = index">
                <span class="line-number">{{ i + 1 }}</span>
                <span class="code-content" [ngClass]="{'code-addition': line.startsWith('+'), 'code-deletion': line.startsWith('-')}">
                  {{ line }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <ngx-skeleton-loader *ngIf="isLoading"
                             appearance="custom-content"
                             [theme]="{
    'background-color': 'rgba(255, 255, 255, 0.1)',
    'border-radius': '10px',
    'height': '100%',
    'width': '100%',
    'backdrop-filter': 'blur(10px)'
  }">
        </ngx-skeleton-loader>

        <div class="card h-100" *ngIf="!isLoading">
          <div class="card-header">
            AI Review for {{ file.filename }}
          </div>
          <div class="card-body">
            <ng-container>
              <p class="card-text">{{ file.aiReview }}</p>
            </ng-container>
          </div>
        </div>
      </div>

    </div>
  </ng-content>
</div>

